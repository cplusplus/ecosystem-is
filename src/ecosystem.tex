%% main file for the C++ Ecosystem International Standard.
%%

%%--------------------------------------------------
%% basics
\documentclass[a4paper,10pt,twoside,openany,final]{memoir}

\usepackage[american]
           {babel}        % needed for iso dates
\usepackage[iso,american]
           {isodate}      % use iso format for dates
\usepackage[final]
           {listings}     % code listings
\usepackage{longtable}    % auto-breaking tables
\usepackage{ltcaption}    % fix captions for long tables
\usepackage{relsize}      % provide relative font size changes
\usepackage{textcomp}     % provide \text{l,r}angle
\usepackage{underscore}   % remove special status of '_' in ordinary text
\usepackage{parskip}      % handle non-indented paragraphs "properly"
\usepackage{array}        % new column definitions for tables
\usepackage[normalem]{ulem}
\usepackage{enumitem}
\usepackage{color}        % define colors for strikeouts and underlines
\usepackage{amsmath}      % additional math symbols
\usepackage{mathrsfs}     % mathscr font
\usepackage[final]{microtype}
\usepackage[original]{imakeidx}
\usepackage{multicol}
\usepackage{lmodern}
\usepackage{xcolor}
\usepackage[T1]{fontenc}
\usepackage[pdftex, final]{graphicx}
\usepackage[pdftex]{hyperref}
\hypersetup{pdftitle={C++ Ecosystem Working Draft},
            pdfsubject={ISO/IEC JTC1 SC22 WG21, C++},
            pdfcreator={Tooling Study Group},
            bookmarksnumbered=true,
            pdfpagemode=UseOutlines,
            pdfstartview=FitH,
            linktocpage=true,
            colorlinks=true,
            linkcolor=blue,
            plainpages=false}
\usepackage{memhfixc}     % fix interactions between hyperref and memoir
% \usepackage[active,header=false,handles=false,copydocumentclass=false,generate=std-gram.ext,extract-cmdline={gramSec},extract-env={bnf,simplebnf}]{extract} % Grammar extraction
\usepackage{expl3}
\usepackage{xparse}
\usepackage{xstring}
\usepackage{datetime2}

\pdfminorversion=5
\pdfcompresslevel=9
\pdfobjcompresslevel=2

\renewcommand\RSsmallest{5.5pt}  % smallest font size for relsize

\input{in_layout}
\input{in_styles}
\input{in_macros}
\input{in_tables}

% Declare the general index (the only one we have)
\makeindex[name=generalindex,title=Index,options=-s eco_generalindex.ist]
\makeglossary[xrefindex]
\makeglossary[xrefdelta]

%%--------------------------------------------------
%% fix interaction between hyperref and other
%% commands
\pdfstringdefDisableCommands{\def\smaller#1{#1}}
\pdfstringdefDisableCommands{\def\textbf#1{#1}}
\pdfstringdefDisableCommands{\def\raisebox#1{}}
\pdfstringdefDisableCommands{\def\hspace#1{}}

%%--------------------------------------------------
%% add special hyphenation rules
\hyphenation{tem-plate ex-am-ple in-put-it-er-a-tor name-space name-spaces non-zero cus-tom-i-za-tion im-ple-men-ted}

%%--------------------------------------------------
%% turn off all ligatures inside \texttt
\DisableLigatures{encoding = T1, family = tt*}

\begin{document}
\chapterstyle{cppstd}
\pagestyle{cpppage}

%%--------------------------------------------------
%% configuration
\input{in_config}

%%--------------------------------------------------
%% front matter
\frontmatter

% Cover
\ifdefined\isofinal
\input{eco_cover_reg}
\else
\input{eco_cover_wd}
\fi

% The table of contents
\markboth{\contentsname}{}
% Make a bit more room for ToC page numbers.
\makeatletter
\renewcommand\@pnumwidth{2.5em}
\makeatother
% Include table of contents. Do not list "Contents"
% within it (per ISO request) but do include a
% bookmark for it in the PDF.
\phantomsection
\pdfbookmark{\contentsname}{toctarget}
\hypertarget{toctarget}{\tableofcontents*}
% ToC levels?
\setcounter{tocdepth}{5}

% Foreword
\input{eco_preface}
\input{eco_preface_changes.tex}
\ifdefined\license
\input{eco_license}
\fi

%%--------------------------------------------------
%% main body of the document
\mainmatter
\setglobalstyles

%%--------------------------------------------------
%% chapters
\input{eco_scope}
\input{eco_refs}
\input{eco_conformance}
\input{eco_defs}
\input{eco_introspection}
\input{eco_strctparam}
\input{eco_strctparam_core}
\input{eco_diag}

%%--------------------------------------------------
%% appendices
\appendix

% % \include and \addtocontents don't mix; see
% % https://tex.stackexchange.com/questions/13914/toc-numbering-problem
% \makeatletter
% \immediate\write\@auxout{\noexpand\@writefile{toc}{\noexpand\let\noexpand\chapternumberlinebox\noexpand\annexnumberlinebox}}
% \makeatother

\input{eco_introspection_annex}
\input{eco_strctparam_annex}

%%--------------------------------------------------
%% back matter
\backmatter
\input{eco_back_biblio}
\input{eco_back_xref}
\input{eco_back_index}

%%--------------------------------------------------
%% End of document
\end{document}
